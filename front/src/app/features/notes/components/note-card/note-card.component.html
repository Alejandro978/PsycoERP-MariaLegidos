<div class="group relative p-3 sm:p-4 hover:bg-gray-50 transition-colors duration-200"
  [class.opacity-60]="note.status === 'completed'">
  <div class="flex items-start gap-2 sm:gap-3">
    <!-- Checkbox -->
    <div class="flex-shrink-0 pt-0.5 sm:pt-1">
      <input type="checkbox"
        [checked]="note.status === 'completed'"
        (change)="handleComplete()"
        [disabled]="note.status === 'completed'"
        class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary focus:ring-2 cursor-pointer disabled:cursor-default">
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0">
      <!-- Message -->
      <p class="text-xs sm:text-sm text-gray-900 break-words" [class.line-through]="note.status === 'completed'">
        {{ note.message }}
      </p>

      <!-- Metadata -->
      <div class="flex flex-wrap items-center gap-2 sm:gap-3 mt-1.5 sm:mt-2 text-xs text-gray-500">
        <span class="flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-calendar h-3 w-3">
            <path d="M8 2v4"></path>
            <path d="M16 2v4"></path>
            <rect width="18" height="18" x="3" y="4" rx="2"></rect>
            <path d="M3 10h18"></path>
          </svg>
          {{ formatDate(note.created_at) }}
        </span>

        @if (note.status === 'completed') {
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-100 text-green-800">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-check h-3 w-3">
            <path d="M20 6 9 17l-5-5"></path>
          </svg>
          Completada
        </span>
        }
      </div>
    </div>

    <!-- Actions Menu -->
    <div class="flex-shrink-0 relative">
      <button type="button" (click)="toggleMenu()"
        class="p-1 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/20">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="lucide lucide-more-horizontal h-5 w-5">
          <circle cx="12" cy="12" r="1"></circle>
          <circle cx="19" cy="12" r="1"></circle>
          <circle cx="5" cy="12" r="1"></circle>
        </svg>
      </button>

      <!-- Dropdown Menu -->
      @if (showMenu) {
      <div class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10">
        <div class="py-1" role="menu">
          @if (note.status === 'pending') {
          <button type="button" (click)="handleComplete()"
            class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-check h-4 w-4">
              <path d="M20 6 9 17l-5-5"></path>
            </svg>
            Marcar como completada
          </button>
          }

          <button type="button" (click)="handleDelete()"
            class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-trash-2 h-4 w-4">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
              <line x1="10" x2="10" y1="11" y2="17"></line>
              <line x1="14" x2="14" y1="11" y2="17"></line>
            </svg>
            Eliminar
          </button>
        </div>
      </div>
      }
    </div>
  </div>
</div>

<!-- Click outside to close menu -->
@if (showMenu) {
<div class="fixed inset-0 z-0" (click)="closeMenu()"></div>
}
